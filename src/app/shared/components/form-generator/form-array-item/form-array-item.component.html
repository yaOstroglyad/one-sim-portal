<div [formGroup]="itemFormGroup" [dir]="dir">
    <ng-container *ngFor="let field of fields">
        <ng-container [ngSwitch]="field.type">
            
            <!-- Text Field -->
            <div *ngSwitchCase="FieldType.text" [attr.class]="'w-100 ' + getFormFieldClass(field)">
                <mat-form-field appearance="outline"
                               class="w-100"
                               [hideRequiredMarker]="field.hideRequiredMarker ?? false">
                    <mat-label>{{ field.label | translate }}</mat-label>
                    <input matInput
                           [formControlName]="field.name"
                           [type]="field.type"
                           (input)="onInputChange($event, field)">
                </mat-form-field>

                <!-- Custom hint outside mat-form-field -->
                <ng-container *ngIf="hasFieldHintOrError(field)">
                    <mat-hint *ngIf="field.hintMessage && field.hintMessage.trim()"
                              [attr.class]="'hint ' + (field.hintClassName || '')">
                        <mat-icon fontIcon="info_outline"></mat-icon>
                        {{ field.hintMessage | translate }}
                    </mat-hint>
                </ng-container>
            </div>

            <!-- Number Field -->
            <div *ngSwitchCase="FieldType.number" [attr.class]="'w-100 ' + getFormFieldClass(field)">
                <mat-form-field appearance="outline"
                                class="w-100"
                                [hideRequiredMarker]="field.hideRequiredMarker ?? false">
                    <mat-label>{{ field.label | translate }}</mat-label>
                    <input matInput
                           [formControlName]="field.name"
                           [type]="field.type"
                           (input)="onInputChange($event, field)">

                    <ng-container *ngIf="hasFieldHintOrError(field)">
                        <mat-hint *ngIf="field.hintMessage && field.hintMessage.trim()"
                                  [attr.class]="'hint ' + (field.hintClassName || '')">
                            <mat-icon fontIcon="info_outline"></mat-icon>
                            {{ field.hintMessage | translate }}
                        </mat-hint>
                    </ng-container>
                </mat-form-field>
            </div>

            <!-- Select Field -->
            <div *ngSwitchCase="FieldType.select" [attr.class]="'w-100 ' + getFormFieldClass(field)">
                <mat-form-field appearance="outline"
                                class="w-100"
                                [hideRequiredMarker]="field.hideRequiredMarker ?? false">
                    <mat-label>{{ field.label | translate }}</mat-label>
                    <mat-select [formControlName]="field.name"
                                (selectionChange)="onInputChange($event, field)"
                                [multiple]="field.multiple">
                        <mat-option *ngFor="let option of getFieldOptions(field) | async" [value]="option.value">
                            {{ option.displayValue }}
                        </mat-option>
                    </mat-select>

                    <ng-container *ngIf="hasFieldHintOrError(field)">
                        <mat-hint *ngIf="field.hintMessage && field.hintMessage.trim()"
                                  [attr.class]="'hint ' + (field.hintClassName || '')">
                            <mat-icon fontIcon="info_outline"></mat-icon>
                            {{ field.hintMessage | translate }}
                        </mat-hint>
                    </ng-container>
                </mat-form-field>
            </div>

            <!-- Textarea Field -->
            <div *ngSwitchCase="FieldType.textarea" [attr.class]="'w-100 ' + getFormFieldClass(field)">
                <mat-form-field appearance="outline"
                                class="w-100"
                                [hideRequiredMarker]="field.hideRequiredMarker ?? false">
                    <mat-label>{{ field.label | translate }}</mat-label>
                    <textarea matInput
                              [formControlName]="field.name"
                              [placeholder]="field.placeholder | translate"
                              (input)="onInputChange($event, field)"></textarea>

                    <ng-container *ngIf="hasFieldHintOrError(field)">
                        <mat-hint *ngIf="field.hintMessage && field.hintMessage.trim()"
                                  [attr.class]="'hint ' + (field.hintClassName || '')">
                            <mat-icon fontIcon="info_outline"></mat-icon>
                            {{ field.hintMessage | translate }}
                        </mat-hint>
                    </ng-container>
                </mat-form-field>
            </div>

            <!-- Password Field -->
            <div *ngSwitchCase="FieldType.password" [attr.class]="'w-100 ' + getFormFieldClass(field)">
                <mat-form-field appearance="outline"
                                class="w-100"
                                [hideRequiredMarker]="field.hideRequiredMarker ?? false">
                    <mat-label>{{ field.label | translate }}</mat-label>
                    <input matInput
                           [formControlName]="field.name"
                           [type]="field.type"
                           (input)="onInputChange($event, field)">

                    <ng-container *ngIf="hasFieldHintOrError(field)">
                        <mat-hint *ngIf="field.hintMessage && field.hintMessage.trim()"
                                  [attr.class]="'hint ' + (field.hintClassName || '')">
                            <mat-icon fontIcon="info_outline"></mat-icon>
                            {{ field.hintMessage | translate }}
                        </mat-hint>
                    </ng-container>
                </mat-form-field>
            </div>

            <!-- Email Field -->
            <div *ngSwitchCase="FieldType.email" [attr.class]="'w-100 ' + getFormFieldClass(field)">
                <mat-form-field appearance="outline"
                               class="w-100"
                               [hideRequiredMarker]="field.hideRequiredMarker ?? false">
                    <mat-label>{{ field.label | translate }}</mat-label>
                    <input matInput
                           [formControlName]="field.name"
                           [type]="field.type"
                           [placeholder]="field.placeholder | translate"
                           type="email"
                           (input)="onInputChange($event, field)">

                    <mat-error *ngIf="shouldShowError(field.name) && itemFormGroup.controls[field.name].hasError('required')"
                               class="error">
                        Email is required
                    </mat-error>
                    <mat-error *ngIf="shouldShowError(field.name) && itemFormGroup.controls[field.name].hasError('email')"
                               class="error">
                        Please, enter email format
                    </mat-error>
                </mat-form-field>

                <!-- Custom hint outside mat-form-field -->
                <ng-container *ngIf="hasFieldHintOrError(field)">
                    <mat-hint *ngIf="field.hintMessage && field.hintMessage.trim()"
                              [attr.class]="'hint ' + (field.hintClassName || '')">
                        <mat-icon fontIcon="info_outline"></mat-icon>
                        {{ field.hintMessage | translate }}
                    </mat-hint>
                </ng-container>
            </div>

            <!-- Checkbox Field -->
            <div *ngSwitchCase="FieldType.checkbox" [attr.class]="'w-100 ' + getFormFieldClass(field)">
                <mat-checkbox [formControlName]="field.name"
                              [color]="'primary'"
                              (change)="onInputChange($event, field)">
                    {{ field.label | translate }}
                </mat-checkbox>
            </div>

            <!-- Other field types can be added here as needed -->
            
        </ng-container>
    </ng-container>
</div>