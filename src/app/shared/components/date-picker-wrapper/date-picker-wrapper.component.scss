@import "../../../../scss/variables";
@import "../../../../scss/utilities";
@import "../../../../scss/mixins";

// ==============================================
// DATE PICKER WRAPPER COMPONENT
// Following project SCSS architecture
// ==============================================

:host {
  .date-picker-wrapper {
    width: 100% !important;
    background: var(--os-color-primary-white);

    // Size variants using utility scale
    &.date-picker--small {
      .date-picker-field {
        font-size: map-get($os-font-sizes, 'sm') !important;

        ::ng-deep .mat-mdc-text-field-wrapper {
          height: 36px !important;
        }
      }
    }

    &.date-picker--medium {
      .date-picker-field {
        font-size: map-get($os-font-sizes, 'base') !important;

        ::ng-deep .mat-mdc-text-field-wrapper {
          height: 44px !important;
        }
      }
    }

    &.date-picker--large {
      .date-picker-field {
        font-size: map-get($os-font-sizes, 'lg') !important;

        ::ng-deep .mat-mdc-text-field-wrapper {
          height: 52px !important;
        }
      }
    }

    // Date picker field base styling - Override Material styles to match CoreUI
    .date-picker-field {
      width: 100% !important;

      // CRITICAL: Override Material form field to look like CoreUI inputs - MAXIMUM SPECIFICITY
      ::ng-deep .mat-mdc-form-field.mat-form-field,
      ::ng-deep .mat-mdc-form-field {
        margin-bottom: 0 !important;

        // Hide Material outline completely
        .mat-mdc-form-field-outline {
          display: none !important;
        }

        // Style the wrapper to match CoreUI input styling exactly - HIGHER SPECIFICITY
        &.mat-mdc-form-field .mat-mdc-form-field-wrapper,
        .mat-mdc-form-field-wrapper {
          border: 1px solid var(--cui-input-border-color, #d8dbe0) !important;
          border-radius: var(--cui-border-radius, 0.375rem) !important;
          height: 44px !important;
          padding: 0 !important;
          transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out !important;
          box-sizing: border-box !important;

          &:hover {
            border-color: var(--cui-input-border-color-focus, #86b7fe) !important;
          }
        }

        // Input styling to exactly match CoreUI - HIGHER SPECIFICITY
        &.mat-mdc-form-field .mat-mdc-input-element,
        .mat-mdc-input-element {
          color: var(--cui-input-color, #495057) !important;
          font-family: inherit !important;
          font-size: 0.875rem !important;
          font-weight: 400 !important;
          line-height: 44px !important; // Use line-height to center text vertically
          padding: 0 2.5rem 0 0.875rem !important; // Horizontal padding only
          height: 44px !important; // Full height to match wrapper
          background-color: transparent !important;
          background-image: none !important;
          border: none !important;
          box-shadow: none !important;
          outline: none !important;
          vertical-align: middle !important; // Additional centering
          box-sizing: border-box !important;

          &::placeholder {
            color: var(--cui-input-placeholder-color, #6c757d) !important;
            opacity: 1 !important;
            line-height: 44px !important; // Center placeholder text too
          }

          &:focus {
            outline: none !important;
            box-shadow: none !important;
          }

          &:disabled {
            opacity: 0.65 !important;
            color: var(--cui-input-disabled-color, #6c757d) !important;
            background-color: transparent !important; // Keep transparent for disabled
            cursor: not-allowed !important;
          }
        }

        // Remove Material label completely for now
        .mat-mdc-form-field-label {
          display: none !important;
        }

        // Focus styling to match CoreUI
        &.mat-focused {
          .mat-mdc-form-field-wrapper {
            border-color: var(--cui-input-border-color-focus, #86b7fe) !important;
            box-shadow: 0 0 0 0.25rem rgba(var(--cui-primary-rgb, 13, 110, 253), 0.25) !important;
          }
        }

        // Error styling to match CoreUI
        &.mat-form-field-invalid {
          .mat-mdc-form-field-wrapper {
            border-color: var(--cui-danger, #dc3545) !important;
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25) !important;
          }
        }

        // Style the datepicker toggle button
        .mat-datepicker-toggle {
          position: absolute !important;
          right: 0.875rem !important;
          top: 50% !important;
          transform: translateY(-50%) !important;
          color: var(--cui-secondary-color) !important;
          border: none !important;
          background: none !important;
          padding: 4px !important;

          .mat-datepicker-toggle-default-icon {
            width: 16px !important;
            height: 16px !important;
          }

          &:hover {
            color: var(--cui-primary) !important;
          }
        }

        // Remove Material's suffix container padding
        .mat-mdc-form-field-suffix {
          padding-left: 0 !important;
        }

        // Remove Material's text field wrapper padding - HIGHER SPECIFICITY
        &.mat-mdc-form-field .mat-mdc-text-field-wrapper,
        .mat-mdc-text-field-wrapper {
          padding: 0 !important;
          border-radius: var(--cui-border-radius, 0.375rem) !important;
        }

        // Set Material's form field infix for proper centering - HIGHER SPECIFICITY
        &.mat-mdc-form-field .mat-mdc-form-field-infix,
        .mat-mdc-form-field-infix {
          padding: 0 !important;
          border: none !important;
          min-height: 44px !important; // Match wrapper height
          width: auto !important;
          position: relative !important;
          display: flex !important;
          align-items: center !important; // Center content vertically
        }

        // Ensure the input takes full width and is centered - HIGHER SPECIFICITY
        &.mat-mdc-form-field .mat-mdc-form-field-flex,
        .mat-mdc-form-field-flex {
          align-items: center !important;
          padding: 0 !important;
          position: relative !important;
          height: 44px !important; // Explicit height
          display: flex !important;
        }
      }

      // CRITICAL: Hide Material's subscript wrapper completely to avoid extra space
      ::ng-deep .mat-mdc-form-field-subscript-wrapper {
        display: none !important;
        height: 0 !important;
        min-height: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      // Hide all hint and error related Material elements
      ::ng-deep .mat-mdc-form-field-hint-wrapper,
      ::ng-deep .mat-mdc-form-field-error-wrapper,
      ::ng-deep .mat-mdc-form-field-hint-spacer {
        display: none !important;
        height: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
      }
    }

    // Date range specific styling
    .date-range-container {
      display: flex !important;
      align-items: center !important;
      gap: map-get($os-spacing, '3') !important; // 12px

      .date-range-start,
      .date-range-end {
        flex: 1 !important;
        min-width: 180px !important; // Match other form fields
      }

      @media (max-width: 768px) {
        flex-direction: column !important;
        gap: map-get($os-spacing, '4') !important; // 16px

        .date-range-start,
        .date-range-end {
          width: 100% !important;
          min-width: auto !important;
        }
      }

      .range-helper-text {
        color: var(--os-color-medium) !important;
        font-size: map-get($os-font-sizes, 'xs') !important;
        margin-top: map-get($os-spacing, '2') !important;
        text-align: center !important;

        @media (min-width: 768px) {
          text-align: left !important;
        }
      }
    }

    // State variations
    &.has-error {
      .date-picker-field {
        ::ng-deep .mat-mdc-form-field-outline .mat-mdc-form-field-outline-thick {
          border-color: var(--os-color-danger) !important;
        }
      }
    }

    &.disabled {
      .date-picker-field {
        ::ng-deep .mat-mdc-form-field {
          opacity: 0.65 !important;
          pointer-events: none !important;
        }
      }
    }
  }
}

// Additional high-specificity overrides in case styles don't apply immediately
:host ::ng-deep .mat-mdc-form-field {
  .mat-mdc-form-field-infix {
    padding: 0 !important;
    min-height: 44px !important;
    display: flex !important;
    align-items: center !important;
  }

  .mat-mdc-form-field-wrapper {
    height: 44px !important;
    padding: 0 !important;
  }

  .mat-mdc-input-element {
    height: 44px !important;
    line-height: 44px !important;
  }
}

// Global datepicker overlay styling
::ng-deep .mat-datepicker-popup {
  .mat-calendar {
    border-radius: map-get($os-border-radius, 'lg') !important;
    @include elevation(3); // Using project elevation mixin

    .mat-calendar-header {
      background-color: var(--os-color-primary) !important;
      color: var(--os-color-white) !important;
      border-radius: map-get($os-border-radius, 'lg') map-get($os-border-radius, 'lg') 0 0 !important;
    }

    .mat-calendar-body-selected {
      background-color: var(--os-color-primary) !important;
      color: var(--os-color-white) !important;
    }

    .mat-calendar-body-today:not(.mat-calendar-body-selected) {
      border-color: var(--os-color-primary) !important;
    }

    .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover {
      background-color: rgba(var(--os-color-primary-rgb), 0.1) !important;
    }
  }
}

// Dark theme support using project patterns
[data-coreui-theme="dark"] {
  :host {
    .date-picker-wrapper {
      .date-picker-field {
        ::ng-deep .mat-mdc-form-field {
          .mat-mdc-input-element {
            color: var(--os-color-light) !important;

            &::placeholder {
              color: var(--os-color-medium) !important;
            }
          }

          .mat-mdc-form-field-outline {
            color: var(--os-color-medium) !important;
          }
        }
      }
    }
  }

  ::ng-deep .mat-datepicker-popup {
    .mat-calendar {
      background-color: var(--os-color-dark) !important;
      color: var(--os-color-light) !important;
    }
  }
}

// RTL support
[dir="rtl"] {
  :host {
    .date-picker-wrapper {
      .date-range-container {
        .date-range-start {
          order: 2 !important;
        }

        .date-range-end {
          order: 1 !important;
        }
      }
    }
  }
}
